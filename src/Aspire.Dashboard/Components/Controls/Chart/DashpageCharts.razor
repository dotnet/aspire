@using Aspire.Dashboard.Components.Pages
@using Aspire.Dashboard.Model
@using Aspire.Dashboard.Model.Otlp
@using Aspire.Dashboard.Otlp.Model

<FluentGrid Spacing="2" AdaptiveRendering="true" Style="padding-right: 10px;">
    @foreach (var chart in SelectedDashpage.Charts)
    {
        if (Instruments.FirstOrDefault(i => i.Name == chart.InstrumentName) is { } instrument)
        {
            <FluentGridItem md="6" lg="4">
                <FluentCard>
                    <div style="padding-left: 20px">
                        <ChartContainer
                            ApplicationKey="@(SelectedApplication.Id!.GetApplicationKey())"
                            MeterName="@(instrument.Parent.MeterName)"
                            InstrumentName="@(instrument.Name)"
                            Duration="@SelectedDuration.Id"
                            ActiveView="@(SelectedViewKind ?? Metrics.MetricViewKind.Graph)"
                            OnViewChangedAsync="@OnViewChangedAsync"
                            Applications="@Applications"
                            IsDashpageChart="true"/>
                    </div>
                </FluentCard>
            </FluentGridItem>
        }
    }
</FluentGrid>

@code {
    [Parameter, EditorRequired]
    public required List<OtlpApplication> Applications { get; set; }

    [Parameter, EditorRequired]
    public required SelectViewModel<ResourceTypeDetails> SelectedApplication { get; set; }

    [Parameter]
    public required OtlpMeter SelectedMeter { get; set; }

    [Parameter, EditorRequired]
    public required DashpageDefinition SelectedDashpage { get; set; }

    [Parameter, EditorRequired]
    public required List<OtlpInstrument> Instruments { get; set; }

    [Parameter, EditorRequired]
    public required Func<Metrics.MetricViewKind, Task> OnViewChangedAsync { get; set; }

    [Parameter, EditorRequired]
    public required Metrics.MetricViewKind? SelectedViewKind { get; set; }

    [Parameter, EditorRequired]
    public required SelectViewModel<TimeSpan> SelectedDuration { get; set; }
}
