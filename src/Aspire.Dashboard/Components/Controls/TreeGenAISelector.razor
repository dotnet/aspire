@using Aspire.Dashboard.Otlp.Model
@using Metrics = Aspire.Dashboard.Resources.Metrics

<FluentTreeView Class="genai-event-tree" @bind-CurrentSelected="@PageViewModel.SelectedTreeItem" @bind-CurrentSelected:after="HandleSelectedTreeItemChangedAsync">
    <ChildContent>
        <FluentTreeItem @key="@PageViewModel.Span" Data="@PageViewModel.Span" title="@PageViewModel.Span.Name" InitiallySelected="@(PageViewModel.SelectedEvent is null)">
            <span class="llm-badge">LLM</span> @PageViewModel.Span.Name
        </FluentTreeItem>

        @foreach (var spanEvent in PageViewModel.Events.OrderBy(i => i.TimeStamp))
        {
            <FluentTreeItem @key="spanEvent" Data="@spanEvent" title="@spanEvent.Type.ToString()" InitiallySelected="@(spanEvent.InternalId == PageViewModel.SelectedEvent?.InternalId)">
                <div style="margin-left: 16px; pointer-events: none;">
                    <GenAIEventTitle Event="spanEvent" ResourceName="@spanEvent.ResourceName" />
                </div>
            </FluentTreeItem>
        }
    </ChildContent>
</FluentTreeView>
