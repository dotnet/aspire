<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>$(NetCurrent)</TargetFramework>

    <IsTestProject>true</IsTestProject>
    <!-- no docker support on helix/windows yet -->
    <RunTestsOnHelix Condition="'$(OS)' != 'Windows_NT'">true</RunTestsOnHelix>
    <SkipTests Condition="'$(OS)' == 'Windows_NT'">true</SkipTests>

    <RelativeStagingDir>staging-for-archive\</RelativeStagingDir>
    <TestArchiveTestsDir>$(TestArchiveTestsDirForPlaygroundTests)</TestArchiveTestsDir>

    <!-- FIXME: reduce to one property? -->
    <ExtractTestClassNamesForHelix Condition="'$(ContinuousIntegrationBuild)' == 'true' or '$(ArchiveTests)' == 'true'">true</ExtractTestClassNamesForHelix>
    <ExtractTestClassNamesPrefix>Aspire.Playground.Tests</ExtractTestClassNamesPrefix>

    <PlaygroundSourceDir Condition="'$(PlaygroundSourceDir)' == ''">$(MSBuildThisFileDirectory)..\..\playground\</PlaygroundSourceDir>

    <RunSettingsFilePath>$(MSBuildThisFileDirectory).runsettings</RunSettingsFilePath>
    <IncludeTestPackages Condition="'$(TestsRunningOutsideOfRepo)' == 'true'">true</IncludeTestPackages>
    <SupportsRunningOutsideOfRepo>true</SupportsRunningOutsideOfRepo>
  </PropertyGroup>

  <ItemGroup>
    <NonComponentReferenceForTests Include="Aspire.Hosting.Testing" />
    <NonComponentReferenceForTests Include="Aspire.Hosting.Azure" />
    <NonComponentReferenceForTests Include="Aspire.Hosting.AppHost" />
    <NonComponentReferenceForTests Include="Aspire.Hosting.NodeJs" />

    <ProjectReference Include="$(PlaygroundSourceDir)AspireEventHub/EventHubs.AppHost/EventHubs.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)AzureStorageEndToEnd/AzureStorageEndToEnd.AppHost/AzureStorageEndToEnd.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)DatabaseMigration/DatabaseMigration.AppHost/DatabaseMigration.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)ParameterEndToEnd/ParameterEndToEnd.AppHost/ParameterEndToEnd.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)ProxylessEndToEnd/ProxylessEndToEnd.AppHost/ProxylessEndToEnd.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)Qdrant/Qdrant.AppHost/Qdrant.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)SqlServerEndToEnd/SqlServerEndToEnd.AppHost/SqlServerEndToEnd.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)Stress/Stress.AppHost/Stress.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)dapr/AppHost/DaprAppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)kafka/KafkaBasic.AppHost/KafkaBasic.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)mongo/Mongo.AppHost/Mongo.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)mysql/MySqlDb.AppHost/MySqlDb.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)nats/Nats.AppHost/Nats.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)orleans/OrleansAppHost/OrleansAppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)seq/Seq.AppHost/Seq.AppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)signalr/SignalRAppHost/SignalRAppHost.csproj" />
    <ProjectReference Include="$(PlaygroundSourceDir)webpubsub/WebPubSubAppHost/WebPubSubAppHost.csproj" />

    <!-- failing
      <ProjectReference Include="$(PlaygroundSourceDir)CustomResources/CustomResources.AppHost/CustomResources.AppHost.csproj" />
      <ProjectReference Include="$(PlaygroundSourceDir)PostgresEndToEnd/PostgresEndToEnd.AppHost/PostgresEndToEnd.AppHost.csproj" />
      <ProjectReference Include="$(PlaygroundSourceDir)TestShop/AppHost/AppHost.csproj" />
      <ProjectReference Include="$(PlaygroundSourceDir)milvus/MilvusPlayground.AppHost/MilvusPlayground.AppHost.csproj" />
      <ProjectReference Include="$(PlaygroundSourceDir)withdockerfile/WithDockerfile.AppHost/WithDockerfile.AppHost.csproj" />
      <ProjectReference Include="$(PlaygroundSourceDir)CosmosEndToEnd/CosmosEndToEnd.AppHost/CosmosEndToEnd.AppHost.csproj" />

      - needs .venv to be initialized
     <ProjectReference Include="$(PlaygroundSourceDir)python/Python.AppHost/Python.AppHost.csproj" />
    -->

    <!-- Need azure, aws subscription
      <ProjectReference Include="$(PlaygroundSourceDir)AWS/AWS.AppHost/AWS.AppHost.csproj" />
      <ProjectReference Include="$(PlaygroundSourceDir)AzureSearchEndToEnd/AzureSearch.AppHost/AzureSearch.AppHost.csproj" />
      <ProjectReference Include="$(PlaygroundSourceDir)OpenAIEndToEnd/OpenAIEndToEnd.AppHost/OpenAIEndToEnd.AppHost.csproj" />
      <ProjectReference Include="$(PlaygroundSourceDir)bicep/BicepSample.AppHost/BicepSample.AppHost.csproj" />
      <ProjectReference Include="$(PlaygroundSourceDir)cdk/CdkSample.AppHost/CdkSample.AppHost.csproj" />
    -->

    <PackageReference Include="Microsoft.DotNet.XUnitExtensions" />
    <PackageReference Include="Microsoft.Extensions.Http.Resilience" />

    <Using Include="Aspire.Hosting.Testing" />
  </ItemGroup>

  <ItemGroup Condition="'$(ArchiveTests)' == 'true'">
    <None Include="$(MSBuildProjectDirectory)\**\*" Link="$(RelativeStagingDir)tests\$(MSBuildProjectName)\%(RecursiveDir)%(FileName)%(Extension)" CopyToOutputDirectory="PreserveNewest" />
    <None Include="$(RepoRoot)src\Shared\**\*" Link="$(RelativeStagingDir)src\Shared\%(RecursiveDir)%(FileName)%(Extension)" CopyToOutputDirectory="PreserveNewest" />
    <None Include="$(RepoRoot)playground\**\*" Link="$(RelativeStagingDir)playground\%(RecursiveDir)%(FileName)%(Extension)" CopyToOutputDirectory="PreserveNewest" />
  </ItemGroup>

</Project>
