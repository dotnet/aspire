{
  "$schema": "https://json.schemastore.org/aspire-8.0.json",
  "resources": {
    "val": {
      "type": "parameter.v0",
      "value": "{val.inputs.value}",
      "inputs": {
        "value": {
          "type": "string"
        }
      }
    },
    "test": {
      "type": "azure.bicep.v0",
      "path": "test.bicep",
      "params": {
        "test": "{val.value}",
        "p2": "{test0.outputs.val0}",
        "values": [
          "one",
          "two"
        ]
      }
    },
    "test0": {
      "type": "azure.bicep.v0",
      "path": "test0.module.bicep"
    },
    "kv3": {
      "type": "azure.bicep.v0",
      "connectionString": "{kv3.outputs.vaultUri}",
      "path": "kv3.module.bicep"
    },
    "appConfig": {
      "type": "azure.bicep.v0",
      "connectionString": "{appConfig.outputs.appConfigEndpoint}",
      "path": "appConfig.module.bicep",
      "params": {
        "sku": "standard"
      }
    },
    "storage": {
      "type": "azure.bicep.v0",
      "path": "storage.module.bicep"
    },
    "blob": {
      "type": "value.v0",
      "connectionString": "{storage.outputs.blobEndpoint}"
    },
    "table": {
      "type": "value.v0",
      "connectionString": "{storage.outputs.tableEndpoint}"
    },
    "queue": {
      "type": "value.v0",
      "connectionString": "{storage.outputs.queueEndpoint}"
    },
    "sql": {
      "type": "azure.bicep.v0",
      "connectionString": "Server=tcp:{sql.outputs.sqlServerFqdn},1433;Encrypt=True;Authentication=\u0022Active Directory Default\u0022",
      "path": "sql.module.bicep"
    },
    "db": {
      "type": "value.v0",
      "connectionString": "{sql.connectionString};Database=db"
    },
    "administratorLogin": {
      "type": "parameter.v0",
      "value": "{administratorLogin.inputs.value}",
      "inputs": {
        "value": {
          "type": "string"
        }
      }
    },
    "administratorLoginPassword": {
      "type": "parameter.v0",
      "value": "{administratorLoginPassword.inputs.value}",
      "inputs": {
        "value": {
          "type": "string",
          "secret": true
        }
      }
    },
    "postgres2": {
      "type": "azure.bicep.v0",
      "connectionString": "{postgres2-kv.secrets.connectionstrings--postgres2}",
      "path": "postgres2.module.bicep",
      "params": {
        "administratorLogin": "{administratorLogin.value}",
        "administratorLoginPassword": "{administratorLoginPassword.value}",
        "postgres2_kv_outputs_name": "{postgres2-kv.outputs.name}"
      }
    },
    "postgres2-kv": {
      "type": "azure.bicep.v0",
      "connectionString": "{postgres2-kv.outputs.vaultUri}",
      "path": "postgres2-kv.module.bicep"
    },
    "db2": {
      "type": "value.v0",
      "connectionString": "{postgres2-kv.secrets.connectionstrings--db2}"
    },
    "cosmos": {
      "type": "azure.bicep.v0",
      "connectionString": "{cosmos.outputs.connectionString}",
      "path": "cosmos.module.bicep"
    },
    "db3": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=db3"
    },
    "lawkspc": {
      "type": "azure.bicep.v0",
      "path": "lawkspc.module.bicep"
    },
    "ai": {
      "type": "azure.bicep.v0",
      "connectionString": "{ai.outputs.appInsightsConnectionString}",
      "path": "ai.module.bicep",
      "params": {
        "lawkspc_outputs_loganalyticsworkspaceid": "{lawkspc.outputs.logAnalyticsWorkspaceId}"
      }
    },
    "aiwithoutlaw": {
      "type": "azure.bicep.v0",
      "connectionString": "{aiwithoutlaw.outputs.appInsightsConnectionString}",
      "path": "aiwithoutlaw.module.bicep"
    },
    "redis": {
      "type": "azure.bicep.v0",
      "connectionString": "{redis.outputs.connectionString}",
      "path": "redis.module.bicep"
    },
    "sb": {
      "type": "azure.bicep.v0",
      "connectionString": "{sb.outputs.serviceBusEndpoint}",
      "path": "sb.module.bicep"
    },
    "queue1": {
      "type": "value.v0",
      "connectionString": "Endpoint={sb.outputs.serviceBusEndpoint};EntityPath=queue1"
    },
    "topic1": {
      "type": "value.v0",
      "connectionString": "Endpoint={sb.outputs.serviceBusEndpoint};EntityPath=topic1"
    },
    "subscription1": {
      "type": "value.v0",
      "connectionString": "Endpoint={sb.outputs.serviceBusEndpoint};EntityPath=topic1/Subscriptions/subscription1"
    },
    "subscription2": {
      "type": "value.v0",
      "connectionString": "Endpoint={sb.outputs.serviceBusEndpoint};EntityPath=topic1/Subscriptions/subscription2"
    },
    "topic2": {
      "type": "value.v0",
      "connectionString": "Endpoint={sb.outputs.serviceBusEndpoint};EntityPath=topic2"
    },
    "topic2sub": {
      "type": "value.v0",
      "connectionString": "Endpoint={sb.outputs.serviceBusEndpoint};EntityPath=topic2/Subscriptions/subscription1"
    },
    "signalr": {
      "type": "azure.bicep.v0",
      "connectionString": "Endpoint=https://{signalr.outputs.hostName};AuthType=azure",
      "path": "signalr.module.bicep"
    },
    "wps": {
      "type": "azure.bicep.v0",
      "connectionString": "{wps.outputs.endpoint}",
      "path": "wps.module.bicep"
    },
    "api": {
      "type": "project.v0",
      "path": "../BicepSample.ApiService/BicepSample.ApiService.csproj",
      "env": {
        "OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY": "in_memory",
        "ASPNETCORE_FORWARDEDHEADERS_ENABLED": "true",
        "HTTP_PORTS": "{api.bindings.http.targetPort}",
        "ConnectionStrings__db": "{db.connectionString}",
        "DB_HOST": "{sql.outputs.sqlServerFqdn}",
        "DB_PORT": "1433",
        "DB_URI": "mssql://{sql.outputs.sqlServerFqdn}:1433/db",
        "DB_JDBCCONNECTIONSTRING": "jdbc:sqlserver://{sql.outputs.sqlServerFqdn}:1433;database=db;encrypt=true;trustServerCertificate=false",
        "DB_DATABASENAME": "db",
        "ConnectionStrings__db2": "{db2.connectionString}",
        "DB2_HOST": "{postgres2.outputs.hostName}",
        "DB2_PORT": "5432",
        "DB2_URI": "postgresql://{administratorLogin.value}:{administratorLoginPassword.value}@{postgres2.outputs.hostName}/db2",
        "DB2_JDBCCONNECTIONSTRING": "jdbc:postgresql://{postgres2.outputs.hostName}/db2?sslmode=require\u0026authenticationPluginClassName=com.azure.identity.extensions.jdbc.postgresql.AzurePostgresqlAuthenticationPlugin",
        "DB2_USERNAME": "{administratorLogin.value}",
        "DB2_PASSWORD": "{administratorLoginPassword.value}",
        "DB2_DATABASENAME": "db2",
        "ConnectionStrings__cosmos": "{cosmos.connectionString}",
        "COSMOS_URI": "{cosmos.outputs.connectionString}",
        "ConnectionStrings__blob": "{blob.connectionString}",
        "BLOB_URI": "{storage.outputs.blobEndpoint}",
        "ConnectionStrings__table": "{table.connectionString}",
        "TABLE_URI": "{storage.outputs.tableEndpoint}",
        "ConnectionStrings__queue": "{queue.connectionString}",
        "QUEUE_URI": "{storage.outputs.queueEndpoint}",
        "ConnectionStrings__kv3": "{kv3.connectionString}",
        "KV3_URI": "{kv3.outputs.vaultUri}",
        "ConnectionStrings__appConfig": "{appConfig.connectionString}",
        "APPLICATIONINSIGHTS_CONNECTION_STRING": "{ai.connectionString}",
        "ConnectionStrings__redis": "{redis.connectionString}",
        "REDIS_HOST": "{redis.outputs.hostName}",
        "REDIS_PORT": "10000",
        "REDIS_URI": "rediss://{redis.outputs.hostName}:10000",
        "ConnectionStrings__sb": "{sb.connectionString}",
        "SB_HOST": "{sb.outputs.serviceBusHostName}",
        "SB_URI": "{sb.outputs.serviceBusEndpoint}",
        "ConnectionStrings__signalr": "{signalr.connectionString}",
        "SIGNALR_URI": "https://{signalr.outputs.hostName}",
        "ConnectionStrings__wps": "{wps.connectionString}",
        "WPS_URI": "{wps.outputs.endpoint}",
        "bicepValue_test": "{test.outputs.test}",
        "bicepValue0": "{test.outputs.val0}",
        "bicepValue1": "{test.outputs.val1}"
      },
      "bindings": {
        "http": {
          "scheme": "http",
          "protocol": "tcp",
          "transport": "http",
          "external": true
        },
        "https": {
          "scheme": "https",
          "protocol": "tcp",
          "transport": "http",
          "external": true
        }
      }
    },
    "kv3-roles": {
      "type": "azure.bicep.v0",
      "path": "kv3-roles.module.bicep",
      "params": {
        "kv3_outputs_name": "{kv3.outputs.name}",
        "principalType": "",
        "principalId": ""
      }
    },
    "appConfig-roles": {
      "type": "azure.bicep.v0",
      "path": "appConfig-roles.module.bicep",
      "params": {
        "appconfig_outputs_name": "{appConfig.outputs.name}",
        "principalType": "",
        "principalId": ""
      }
    },
    "storage-roles": {
      "type": "azure.bicep.v0",
      "path": "storage-roles.module.bicep",
      "params": {
        "storage_outputs_name": "{storage.outputs.name}",
        "principalType": "",
        "principalId": ""
      }
    },
    "sql-roles": {
      "type": "azure.bicep.v0",
      "path": "sql-roles.module.bicep",
      "params": {
        "sql_outputs_name": "{sql.outputs.name}",
        "sql_outputs_sqlserveradminname": "{sql.outputs.sqlServerAdminName}",
        "principalId": "",
        "principalName": "",
        "principalType": ""
      }
    },
    "postgres2-kv-roles": {
      "type": "azure.bicep.v0",
      "path": "postgres2-kv-roles.module.bicep",
      "params": {
        "postgres2_kv_outputs_name": "{postgres2-kv.outputs.name}",
        "principalType": "",
        "principalId": ""
      }
    },
    "cosmos-roles": {
      "type": "azure.bicep.v0",
      "path": "cosmos-roles.module.bicep",
      "params": {
        "cosmos_outputs_name": "{cosmos.outputs.name}",
        "principalId": ""
      }
    },
    "redis-roles": {
      "type": "azure.bicep.v0",
      "path": "redis-roles.module.bicep",
      "params": {
        "redis_outputs_name": "{redis.outputs.name}",
        "principalId": ""
      }
    },
    "sb-roles": {
      "type": "azure.bicep.v0",
      "path": "sb-roles.module.bicep",
      "params": {
        "sb_outputs_name": "{sb.outputs.name}",
        "principalType": "",
        "principalId": ""
      }
    },
    "signalr-roles": {
      "type": "azure.bicep.v0",
      "path": "signalr-roles.module.bicep",
      "params": {
        "signalr_outputs_name": "{signalr.outputs.name}",
        "principalType": "",
        "principalId": ""
      }
    },
    "wps-roles": {
      "type": "azure.bicep.v0",
      "path": "wps-roles.module.bicep",
      "params": {
        "wps_outputs_name": "{wps.outputs.name}",
        "principalType": "",
        "principalId": ""
      }
    },
    "administratorLogin-uri-encoded": {
      "type": "annotated.string",
      "value": "{administratorLogin.value}",
      "filter": "uri"
    },
    "administratorLoginPassword-uri-encoded": {
      "type": "annotated.string",
      "value": "{administratorLoginPassword.value}",
      "filter": "uri"
    }
  }
}