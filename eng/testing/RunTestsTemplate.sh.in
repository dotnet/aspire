#!/usr/bin/env bash

set -x
set -e

EXECUTION_DIR=$(dirname $0)

if [[ -z "$HELIX_WORKITEM_UPLOAD_ROOT" ]]; then
    LOGS_PATH="$EXECUTION_DIR/logs"
    COVERAGE_TOOL_CMD=dotnet-coverage
else
    LOGS_PATH="$HELIX_WORKITEM_UPLOAD_ROOT/logs"
    COVERAGE_TOOL_CMD=$HELIX_CORRELATION_PAYLOAD/dotnet-coverage/dotnet-coverage
fi

if [[ -n "$PREPEND_PATH" ]]; then
    export PATH=$PREPEND_PATH:$PATH
fi

PATH_FOR_DOTNET=$(dirname $(which dotnet))
export SDK_FOR_WORKLOAD_TESTING_PATH=${SDK_FOR_WORKLOAD_TESTING_PATH:-$PATH_FOR_DOTNET}

# PreCommands
@PreCommands@

# RunCommands
@RunCommands@
